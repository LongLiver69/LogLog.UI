<div class="upload-avatar-container">
  <div class="avatar-preview-section">
    <!-- Preview Circle -->
    <div class="avatar-preview" [class.has-image]="imageUrl" #avatarPreview>
      @if (imageUrl) {
      <div class="image-container" [style.transform]="'scale(' + zoomLevel + ')'">
        <img [src]="imageUrl" alt="Avatar preview"
          [style.transform]="'translate(' + position.x + 'px, ' + position.y + 'px)'" (mousedown)="startDrag($event)"
          draggable="false">
      </div>
      } @else {
      <div class="placeholder">
        <i class="bi bi-person-circle"></i>
        <p>Chọn ảnh</p>
      </div>
      }
    </div>

    <!-- Upload Button -->
    <div class="upload-button-wrapper">
      <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" hidden>
      <button type="button" class="btn btn-primary btn-sm" (click)="fileInput.click()">
        <i class="bi bi-upload"></i>
        {{ imageUrl ? 'Đổi ảnh' : 'Chọn ảnh' }}
      </button>
    </div>
  </div>

  <!-- Controls Section -->
  @if (imageUrl) {
  <div class="controls-section">
    <!-- Zoom Controls -->
    <div class="control-group">
      <label>
        <i class="bi bi-zoom-in"></i>
        Phóng to/Thu nhỏ
      </label>
      <div class="zoom-controls">
        <button type="button" class="btn btn-sm btn-outline-secondary" (click)="zoomOut()"
          [disabled]="zoomLevel <= 0.5">
          <i class="bi bi-dash"></i>
        </button>
        <input type="range" [(ngModel)]="zoomLevel" min="0.5" max="3" step="0.1" class="zoom-slider">
        <button type="button" class="btn btn-sm btn-outline-secondary" (click)="zoomIn()" [disabled]="zoomLevel >= 3">
          <i class="bi bi-plus"></i>
        </button>
        <span class="zoom-value">{{ (zoomLevel * 100).toFixed(0) }}%</span>
      </div>
    </div>

    <!-- Position Reset -->
    <div class="control-group">
      <button type="button" class="btn btn-sm btn-outline-secondary w-100" (click)="resetControls()">
        <i class="bi bi-arrow-counterclockwise"></i>
        Đặt lại vị trí
      </button>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button type="button" class="btn btn-success" (click)="saveAvatar()">
        <i class="bi bi-check-lg"></i>
        Lưu
      </button>
      <button type="button" class="btn btn-secondary" (click)="cancel()">
        <i class="bi bi-x-lg"></i>
        Hủy
      </button>
    </div>
  </div>
  }
</div>